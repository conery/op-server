<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="img/favicon.ico" />
    <title>REST Server for OptiPass - OptiPass Server</title>
    <link rel="stylesheet" href="css/theme.css" />
    <link rel="stylesheet" href="css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="css/tidegates.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "REST Server for OptiPass";
        var mkdocs_page_input_path = "index.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="." class="icon icon-home"> OptiPass Server
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="./search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">REST Server for OptiPass</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#example">Example</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#implementation">Implementation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#deployment">Deployment</a>
    </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="install/">Installation</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="data/">Data</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="modules/">Modules</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="tests/">Tests</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href=".">OptiPass Server</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Home</li>
      <li class="breadcrumb-item active">REST Server for OptiPass</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="rest-server-for-optipass">REST Server for OptiPass</h1>
<p>OptiPass™ is an application developed by Jesse O'Hanley at Ecotelligence®, LLC (https://www.ecotelligence.net/home/optipass).  </p>
<p>The application is written in Visual C++ and runs only in a Microsoft Windows environment.  To make it more accessible to web applications we developed this REST server.  While the server needs to run on a Windows system, clients (such as the one at https://github.com/conery/op-client) can run on any system, or even in a Docker container.</p>
<h2 id="overview">Overview</h2>
<p>The server has two main roles:</p>
<ol>
<li>It manages tide gate data for one or more projects.  Each data set is a CSV file where records describe tide gates and other barriers.  Attributes include barrier names, locations, and so on.  The file also has the attributes OptiPass uses:  the cost to repair or replace a barrier, the upstream habitat impacted by the barrier, and the potential benefit of improving the barrier.</li>
<li>The server provides an API for running OptiPass.  A request to run OptiPass will include the IDs of barriers to include and the budget levels to use in order to generate ROI curves to show potential benefits from increasing budget levels.</li>
</ol>
<p>It would be possible to assign these roles to different applications -- <em>e.g.</em> have separate servers for the data and OptiPass -- but we decided to combine them in order to minimize web traffic.  A client simply needs to know the names and locations of barriers, and descriptions of potential benefits.  The complete data set for the Oregon Coast, for example, is in a CSV file with over 1000 records and is 330KB.  Each request to run OptiPass uses a small fraction of this data, so it makes sense to keep the data on the server and send short descriptions to the client.</p>
<h2 id="example">Example</h2>
<p>A common scenario for testing a FastAPI application is to launch Uvicorn (a Python-based web server) on the development system, passing it the name of the main function and specifying a port to listen to:</p>
<pre><code class="language-bash">$ uvicorn app.main:app --port 8001
</code></pre>
<p>Then to request data from the server, simply send an HTML GET request to that port.  The response will be a JSON-encoded string that can easily be converted into a Python object.  This request asks the server for the names of all the datasets it manages:</p>
<pre><code class="language-bash">$ curl localhost:8001/projects
[&quot;demo&quot;]
</code></pre>
<p>The repository includes a test data set named <code>demo</code> (based on the examples in the OptiPass manual).  Others can be added simply by saving them in the <code>static</code> folder on the server (see <a href="data/">Data</a>).</p>
<h2 id="implementation">Implementation</h2>
<p>The server is written entirely in Python, using FastAPI to manage requests.  The top level directories in the GitHub repository are:</p>
<ul>
<li><code>app</code>: the main FastAPI application</li>
<li><code>bin</code>: a folder for <code>OptiPass.exe</code> and other executables</li>
<li><code>docs</code>:  notes for developers</li>
<li><code>static</code>:  CSV files for barrier data and restoration target descriptions</li>
<li><code>test</code>: unit tests</li>
</ul>
<p>Detailed documentation for the Python code in the <code>app</code> folder can be found in <a href="modules/">Modules</a>.  The test descriptions in <a href="tests/">Unit Tests</a> are a good place to find examples of how to call functions in the modules.</p>
<h2 id="deployment">Deployment</h2>
<p>Developers who want to deploy the server using their own data need to do the following (described in more detail in <a href="install/">Installation</a>):</p>
<ul>
<li>set up a server that runs Microsoft Windows; this can be a stand-alone Windows system on a networked PC, or on a virtual machine at Amazon Web Services or another cloud service</li>
<li>clone the repository (this can be done with a single PIP command)</li>
<li>install the command line version of OptiPass in the <code>bin</code> directory (<strong>OptiPass is not included with the repository</strong>)</li>
<li>add their data files to the <code>static</code> folder (see <a href="data/">Data</a>)</li>
<li>
<p>open a PowerShell window and type the command that starts the server</p>
</li>
<li>
<p>(recommended) set up Nginx, Apache, or some other fully-featured web server and configure it as a reverse proxy</p>
</li>
</ul>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="install/" class="btn btn-neutral float-right" title="Installation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="install/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="js/jquery-3.6.0.min.js"></script>
    <script>var base_url = ".";</script>
    <script src="js/theme_extra.js"></script>
    <script src="js/theme.js"></script>
      <script src="search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
